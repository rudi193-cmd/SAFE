<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAFE — Session-Authorized, Fully Explicit</title>
  <meta name="description" content="A consent framework where your permissions expire with the session. Every time you use an app, you decide what it can access.">
  <style>
    :root {
      --bg: #f9f9f7;
      --fg: #1c1c1a;
      --fg-muted: #555550;
      --accent: #2d6a4f;
      --accent-light: #e8f4ee;
      --border: #e2e2de;
      --max: 680px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.75;
      font-size: 17px;
    }

    /* ── Nav ── */
    nav {
      position: sticky; top: 0;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      z-index: 100; padding: 0 1.5rem;
    }
    .nav-inner {
      max-width: var(--max); margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between; height: 52px;
    }
    .nav-wordmark {
      font-size: 14px; font-weight: 700; letter-spacing: 0.12em;
      color: var(--fg); text-decoration: none; text-transform: uppercase;
    }
    .nav-right { display: flex; align-items: center; gap: 1.25rem; }
    .nav-links { display: flex; gap: 1.25rem; list-style: none; }
    .nav-links a { font-size: 14px; color: var(--fg-muted); text-decoration: none; transition: color 0.15s; }
    .nav-links a:hover { color: var(--accent); }
    .btn-nav-cta {
      font-size: 13px; font-weight: 600; padding: 0.35rem 0.9rem;
      background: var(--accent); color: white; border-radius: 4px;
      border: none; cursor: pointer; font-family: inherit; text-decoration: none;
      transition: background 0.15s; display: inline-block;
    }
    .btn-nav-cta:hover { background: #1e4d38; }
    .nav-user-chip {
      display: none; align-items: center; gap: 0.5rem;
      font-size: 13px; color: var(--fg-muted);
    }
    .nav-user-chip .user-dot {
      width: 8px; height: 8px; border-radius: 50%; background: var(--accent);
    }
    .nav-user-chip a {
      color: var(--fg-muted); text-decoration: none; font-size: 13px;
    }
    .nav-user-chip a:hover { color: var(--accent); }

    /* ── Layout ── */
    .container { max-width: var(--max); margin: 0 auto; padding: 0 1.5rem; }
    section { padding: 4rem 0; border-bottom: 1px solid var(--border); }
    section:last-of-type { border-bottom: none; }

    /* ── Hero ── */
    .hero { padding: 5rem 0 4rem; }
    .hero-label {
      font-size: 12px; font-weight: 600; letter-spacing: 0.14em;
      text-transform: uppercase; color: var(--accent); margin-bottom: 1.25rem;
    }
    .hero-headline {
      font-size: clamp(2rem, 5vw, 3rem); font-weight: 700;
      line-height: 1.2; letter-spacing: -0.02em; margin-bottom: 1.5rem;
    }
    .hero-headline em { font-style: normal; color: var(--accent); }
    .hero-sub { font-size: 19px; color: var(--fg-muted); max-width: 520px; margin-bottom: 2rem; line-height: 1.65; }
    .hero-actions { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
    .btn-primary {
      background: var(--accent); color: white; padding: 0.65rem 1.4rem;
      border-radius: 4px; font-size: 15px; font-weight: 600; text-decoration: none;
      border: none; cursor: pointer; font-family: inherit;
      transition: background 0.15s; display: inline-block;
    }
    .btn-primary:hover { background: #1e4d38; }
    .btn-secondary {
      background: transparent; color: var(--fg); padding: 0.65rem 1.4rem;
      border-radius: 4px; border: 1px solid var(--border); font-size: 15px; font-weight: 500;
      text-decoration: none; transition: border-color 0.15s, color 0.15s; display: inline-block;
    }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
    .hero-logged-in {
      display: none; align-items: center; gap: 1rem; flex-wrap: wrap;
    }
    .hero-logged-in-msg {
      font-size: 15px; color: var(--fg-muted);
    }
    .hero-logged-in-msg strong { color: var(--fg); }

    /* ── Content sections ── */
    .section-label {
      font-size: 11px; font-weight: 700; letter-spacing: 0.16em;
      text-transform: uppercase; color: var(--accent); margin-bottom: 0.75rem;
    }
    h2 { font-size: 1.6rem; font-weight: 700; letter-spacing: -0.01em; margin-bottom: 1rem; }
    p { margin-bottom: 1rem; color: var(--fg-muted); }
    p:last-child { margin-bottom: 0; }
    strong { color: var(--fg); font-weight: 600; }

    .pull-quote {
      border-left: 3px solid var(--accent); padding: 0.75rem 1.25rem; margin: 1.5rem 0;
      font-size: 18px; color: var(--fg); line-height: 1.6; font-style: italic;
    }

    .steps { margin-top: 1.75rem; display: flex; flex-direction: column; gap: 1.25rem; }
    .step { display: grid; grid-template-columns: 2rem 1fr; gap: 1rem; align-items: start; }
    .step-num {
      font-size: 12px; font-weight: 700; color: var(--accent);
      background: var(--accent-light); width: 2rem; height: 2rem; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 0.1rem;
    }
    .step-body strong { display: block; font-size: 16px; margin-bottom: 0.2rem; }
    .step-body p { font-size: 15px; margin: 0; color: var(--fg-muted); }

    .rights-list { margin-top: 1.75rem; list-style: none; display: flex; flex-direction: column; gap: 0.85rem; }
    .rights-list li {
      padding: 0.9rem 1.1rem; background: var(--accent-light); border-radius: 4px;
      display: grid; grid-template-columns: 1.4rem 1fr; gap: 0.75rem; align-items: start;
    }
    .rights-list .right-icon { color: var(--accent); font-weight: 700; font-size: 15px; line-height: 1.5; }
    .rights-list .right-body strong { display: block; font-size: 15px; color: var(--fg); margin-bottom: 0.15rem; }
    .rights-list .right-body p { font-size: 14px; color: var(--fg-muted); margin: 0; line-height: 1.5; }
    .rights-guarantee { margin-top: 1.25rem; font-size: 14px; font-weight: 600; color: var(--accent); }

    .gov-grid { margin-top: 1.75rem; display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .gov-card {
      border: 1px solid var(--border); border-radius: 4px; padding: 1rem;
      text-decoration: none; color: var(--fg); transition: border-color 0.15s;
    }
    .gov-card:hover { border-color: var(--accent); }
    .gov-card .gov-title { font-size: 14px; font-weight: 600; margin-bottom: 0.25rem; color: var(--fg); }
    .gov-card .gov-desc { font-size: 13px; color: var(--fg-muted); line-height: 1.45; margin: 0; }

    .price-block { margin-top: 1.5rem; border: 1px solid var(--border); border-radius: 6px; padding: 1.5rem; }
    .price-amount { font-size: 2.5rem; font-weight: 700; color: var(--fg); letter-spacing: -0.03em; margin-bottom: 0.25rem; }
    .price-label { font-size: 14px; color: var(--fg-muted); margin-bottom: 1rem; }
    .price-principles { list-style: none; display: flex; flex-direction: column; gap: 0.5rem; }
    .price-principles li { font-size: 14px; color: var(--fg-muted); padding-left: 1.1rem; position: relative; }
    .price-principles li::before { content: '—'; position: absolute; left: 0; color: var(--accent); }

    .status-table { margin-top: 1.5rem; width: 100%; border-collapse: collapse; font-size: 15px; }
    .status-table td { padding: 0.6rem 0; border-bottom: 1px solid var(--border); color: var(--fg-muted); }
    .status-table td:first-child { color: var(--fg); font-weight: 500; width: 55%; }
    .status-badge { display: inline-block; font-size: 12px; font-weight: 600; padding: 0.2rem 0.55rem; border-radius: 3px; }
    .badge-green { background: var(--accent-light); color: var(--accent); }
    .badge-yellow { background: #fef9e7; color: #a0720a; }
    .badge-open { background: #f0f0f0; color: #555; }

    /* ── Footer ── */
    footer { padding: 2.5rem 0; border-top: 1px solid var(--border); }
    .footer-inner {
      max-width: var(--max); margin: 0 auto; padding: 0 1.5rem;
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;
    }
    .footer-left { font-size: 13px; color: var(--fg-muted); }
    .footer-left strong { color: var(--fg); }
    .footer-right { font-size: 13px; color: var(--fg-muted); display: flex; gap: 1.5rem; }
    .footer-right a { color: var(--fg-muted); text-decoration: none; transition: color 0.15s; }
    .footer-right a:hover { color: var(--accent); }

    /* ── SETUP MODAL ── */
    .modal-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(28, 28, 26, 0.55); z-index: 500;
      align-items: center; justify-content: center; padding: 1.5rem;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--bg); border-radius: 6px; border: 1px solid var(--border);
      max-width: 460px; width: 100%; padding: 2rem;
      position: relative;
    }
    .modal-close {
      position: absolute; top: 1rem; right: 1rem;
      background: none; border: none; font-size: 18px; color: var(--fg-muted);
      cursor: pointer; line-height: 1; padding: 0.25rem;
    }
    .modal-close:hover { color: var(--fg); }

    .setup-step { display: none; }
    .setup-step.active { display: block; }

    .setup-eyebrow {
      font-size: 11px; font-weight: 700; letter-spacing: 0.16em;
      text-transform: uppercase; color: var(--accent); margin-bottom: 0.6rem;
    }
    .setup-title {
      font-size: 1.3rem; font-weight: 700; letter-spacing: -0.01em;
      margin-bottom: 0.6rem; color: var(--fg);
    }
    .setup-desc {
      font-size: 14px; color: var(--fg-muted); line-height: 1.6; margin-bottom: 1.25rem;
    }
    .setup-field { margin-bottom: 1rem; }
    .setup-field label {
      display: block; font-size: 12px; font-weight: 600;
      letter-spacing: 0.06em; text-transform: uppercase;
      color: var(--fg-muted); margin-bottom: 0.4rem;
    }
    .setup-field input {
      width: 100%; font-family: inherit; font-size: 15px;
      color: var(--fg); background: white;
      border: 1px solid var(--border); border-radius: 4px;
      padding: 0.6rem 0.85rem; outline: none;
      transition: border-color 0.15s;
    }
    .setup-field input:focus { border-color: var(--accent); }
    .setup-field .field-hint {
      font-size: 12px; color: var(--fg-muted); margin-top: 0.35rem; line-height: 1.4;
    }
    .setup-actions {
      display: flex; gap: 0.75rem; align-items: center; margin-top: 1.5rem; flex-wrap: wrap;
    }
    .btn-setup-skip {
      font-size: 13px; color: var(--fg-muted); background: none; border: none;
      cursor: pointer; font-family: inherit; text-decoration: underline;
      text-underline-offset: 3px;
    }
    .btn-setup-skip:hover { color: var(--fg); }
    .setup-progress {
      display: flex; gap: 5px; margin-bottom: 1.5rem;
    }
    .progress-dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--border); transition: background 0.2s;
    }
    .progress-dot.done { background: var(--accent); }
    .progress-dot.active { background: var(--accent); opacity: 0.5; }

    .google-btn {
      width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.75rem;
      padding: 0.65rem 1rem; background: white; border: 1px solid var(--border);
      border-radius: 4px; font-size: 15px; color: var(--fg); cursor: pointer;
      font-family: inherit; transition: border-color 0.15s; margin-bottom: 0.5rem;
    }
    .google-btn:hover { border-color: var(--accent); }

    .ollama-status {
      font-size: 13px; margin-top: 0.5rem;
      display: none;
    }
    .ollama-status.ok { color: var(--accent); display: block; }
    .ollama-status.err { color: #c0392b; display: block; }

    .setup-done-icon {
      font-size: 2rem; margin-bottom: 1rem; color: var(--accent);
    }

    @media (max-width: 600px) {
      .hero-headline { font-size: 2rem; }
      .gov-grid { grid-template-columns: 1fr; }
      .footer-inner { flex-direction: column; align-items: flex-start; }
      .nav-links { display: none; }
    }
  </style>
</head>
<body>

  <nav>
    <div class="nav-inner">
      <a href="#" class="nav-wordmark">SAFE</a>
      <div class="nav-right">
        <ul class="nav-links">
          <li><a href="#how">How it works</a></li>
          <li><a href="#rights">Rights</a></li>
          <li><a href="#governance">Governance</a></li>
          <li><a href="https://github.com/rudi193-cmd/SAFE" target="_blank">GitHub ↗</a></li>
        </ul>
        <div class="nav-user-chip" id="nav-user-chip">
          <span class="user-dot"></span>
          <span id="nav-username"></span>
          <a href="dashboard.html">Dashboard</a>
          <a href="#" id="btn-signout">Sign out</a>
        </div>
        <button class="btn-nav-cta" id="btn-nav-setup">Get Started</button>
      </div>
    </div>
  </nav>

  <div class="container">
    <section class="hero">
      <p class="hero-label">Session-Authorized, Fully Explicit</p>
      <h1 class="hero-headline">Consent that <em>expires.</em></h1>
      <p class="hero-sub">
        You clicked "I Agree" once, years ago. That click still governs your data today.
        SAFE proposes a different model: every session, you decide what an app can access.
        When you close it, those permissions are gone.
      </p>
      <div class="hero-actions" id="hero-actions-anon">
        <button class="btn-primary" id="btn-hero-setup">Get Started</button>
        <a href="#how" class="btn-secondary">See how it works</a>
      </div>
      <div class="hero-logged-in" id="hero-actions-user">
        <span class="hero-logged-in-msg">Welcome back, <strong id="hero-username"></strong>.</span>
        <a href="jane.html" class="btn-primary">Talk to Jane</a>
        <a href="dashboard.html" class="btn-secondary">Your Dashboard</a>
      </div>
    </section>
  </div>

  <div class="container">
    <section>
      <p class="section-label">The problem</p>
      <h2>Perpetual consent is not consent.</h2>
      <p>Current consent models collect one agreement and use it forever. Your decision from 2019 authorizes data collection in 2026. The legal text runs to thousands of words. Nobody reads it. Everyone clicks agree.</p>
      <blockquote class="pull-quote">Consent should require intention. That means asking every time.</blockquote>
      <p>SAFE makes consent a continuous practice instead of a one-time administrative hurdle. Each session is a fresh authorization. Each permission is explicit. Each closure is a clean end.</p>
      <p>This is intentionally inconvenient. That inconvenience is the point.</p>
    </section>
  </div>

  <div class="container">
    <section id="how">
      <p class="section-label">How it works</p>
      <h2>Three moments. Every session.</h2>
      <p>You open an app built on SAFE. Before showing you anything, it asks permission — not once, at setup, but now, for this session.</p>
      <div class="steps">
        <div class="step">
          <div class="step-num">1</div>
          <div class="step-body">
            <strong>Start</strong>
            <p>The app presents an authorization request for each data type it needs. Contacts. Location. Documents. Each one is a separate question.</p>
          </div>
        </div>
        <div class="step">
          <div class="step-num">2</div>
          <div class="step-body">
            <strong>During</strong>
            <p>The app only accesses what you authorized this session. Nothing more. You can revoke mid-session at any time.</p>
          </div>
        </div>
        <div class="step">
          <div class="step-num">3</div>
          <div class="step-body">
            <strong>End</strong>
            <p>You close the app. All authorizations expire. Data is deleted by default unless you explicitly chose to save it. Tomorrow, it asks again.</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="container">
    <section id="rights">
      <p class="section-label">User rights</p>
      <h2>Five guarantees. Not suggestions.</h2>
      <p>Every app built on SAFE must honor these rights. They are not opt-in features. They are the floor.</p>
      <ul class="rights-list">
        <li>
          <span class="right-icon">I</span>
          <div class="right-body"><strong>Right to Zero Retention</strong><p>Decline all data storage. The app runs without saving anything about you.</p></div>
        </li>
        <li>
          <span class="right-icon">II</span>
          <div class="right-body"><strong>Right to Deletion</strong><p>Complete removal of your data on request. No waiting period. No dark patterns.</p></div>
        </li>
        <li>
          <span class="right-icon">III</span>
          <div class="right-body"><strong>Right to Export</strong><p>All data about you, in a readable format, whenever you want it.</p></div>
        </li>
        <li>
          <span class="right-icon">IV</span>
          <div class="right-body"><strong>Right to Audit</strong><p>View exactly what the system knows about you. No inference. No guessing.</p></div>
        </li>
        <li>
          <span class="right-icon">V</span>
          <div class="right-body"><strong>Right to Revoke</strong><p>Withdraw authorization mid-session. The app stops accessing that data immediately.</p></div>
        </li>
      </ul>
      <p class="rights-guarantee">These are not suggestions. They are guarantees.</p>
    </section>
  </div>

  <div class="container">
    <section id="pricing">
      <p class="section-label">Pricing</p>
      <h2>Pay what you can, including&nbsp;$0.</h2>
      <p>SAFE apps share a common pricing philosophy. Not charity — alignment.</p>
      <div class="price-block">
        <div class="price-amount">$1</div>
        <div class="price-label">Suggested donation per month</div>
        <ul class="price-principles">
          <li>No reduced features at $0</li>
          <li>No shame, no second-class service</li>
          <li>Users see the actual operational costs</li>
          <li>When people pay nothing, they still deserve the same service — because the point is consent and dignity, not revenue extraction</li>
        </ul>
      </div>
    </section>
  </div>

  <div class="container">
    <section id="governance">
      <p class="section-label">Governance</p>
      <h2>Rules that cannot be overridden.</h2>
      <p>SAFE is governed by a set of explicit, public documents. The most important are the Hard Stops — absolute constraints that no authority can override. Not the system owner. Not accumulated trust. Not any AI.</p>
      <p>Changes follow the Dual Commit model: someone proposes, someone else ratifies. Neither acts alone.</p>
      <div class="gov-grid">
        <a class="gov-card" href="https://github.com/rudi193-cmd/SAFE/blob/main/governance/CHARTER.md" target="_blank">
          <div class="gov-title">Charter</div>
          <p class="gov-desc">Foundational authority and the principles that cannot be negotiated away.</p>
        </a>
        <a class="gov-card" href="https://github.com/rudi193-cmd/SAFE/blob/main/governance/HARD_STOPS.md" target="_blank">
          <div class="gov-title">Hard Stops</div>
          <p class="gov-desc">Absolute limits. What the system will never do, regardless of authorization.</p>
        </a>
        <a class="gov-card" href="https://github.com/rudi193-cmd/SAFE/blob/main/governance/SESSION_CONSENT.md" target="_blank">
          <div class="gov-title">Session Consent</div>
          <p class="gov-desc">The complete protocol spec for how authorization works session to session.</p>
        </a>
        <a class="gov-card" href="https://github.com/rudi193-cmd/SAFE/blob/main/governance/DUAL_COMMIT.md" target="_blank">
          <div class="gov-title">Dual Commit</div>
          <p class="gov-desc">How changes happen. Proposal plus ratification. No unilateral changes.</p>
        </a>
      </div>
    </section>
  </div>

  <div class="container">
    <section>
      <p class="section-label">Status</p>
      <h2>Where things stand.</h2>
      <p>Open to adoption by any project that handles personal data.</p>
      <table class="status-table">
        <tr><td>Specification</td><td><span class="status-badge badge-green">Stable</span></td></tr>
        <tr><td>Reference Implementation</td><td><span class="status-badge badge-green">Available</span></td></tr>
        <tr><td>Legal Review</td><td><span class="status-badge badge-yellow">Pending</span></td></tr>
        <tr><td>Adoption</td><td><span class="status-badge badge-open">Open</span></td></tr>
      </table>
    </section>
  </div>

  <footer>
    <div class="footer-inner">
      <div class="footer-left">
        <strong>SAFE</strong> — Session-Authorized, Fully Explicit<br>
        MIT License (code) · CC-BY-NC (documentation) · ΔΣ=42
      </div>
      <div class="footer-right">
        <a href="https://github.com/rudi193-cmd/SAFE" target="_blank">GitHub ↗</a>
        <a href="https://github.com/rudi193-cmd/SAFE/blob/main/governance/GOVERNANCE_INDEX.md" target="_blank">Governance ↗</a>
        <a href="https://github.com/rudi193-cmd/SAFE/blob/main/docs/QUICK_START.md" target="_blank">Quick Start ↗</a>
      </div>
    </div>
  </footer>

  <!-- ── SETUP MODAL ── -->
  <div class="modal-overlay" id="setup-modal">
    <div class="modal">
      <button class="modal-close" id="modal-close">✕</button>

      <!-- Step 1: Create account -->
      <div class="setup-step active" id="step-1">
        <div class="setup-progress">
          <div class="progress-dot active" id="dot-1"></div>
          <div class="progress-dot" id="dot-2"></div>
          <div class="progress-dot" id="dot-3"></div>
          <div class="progress-dot" id="dot-4"></div>
        </div>
        <p class="setup-eyebrow">Step 1 of 4</p>
        <h2 class="setup-title">Create your account.</h2>
        <p class="setup-desc">
          Choose a username. This is your local identity — stored on this device only.
          No email required. No server involved.
        </p>
        <div class="setup-field">
          <label for="input-username">Username</label>
          <input type="text" id="input-username" placeholder="e.g. sweet-pea" maxlength="32" autocomplete="off">
          <p class="field-hint">Letters, numbers, and hyphens. Stored in your browser only.</p>
        </div>
        <div class="setup-actions">
          <button class="btn-primary" id="btn-step1-next">Continue</button>
        </div>
      </div>

      <!-- Step 2: Google (optional) -->
      <div class="setup-step" id="step-2">
        <div class="setup-progress">
          <div class="progress-dot done"></div>
          <div class="progress-dot active" id="dot-2b"></div>
          <div class="progress-dot"></div>
          <div class="progress-dot"></div>
        </div>
        <p class="setup-eyebrow">Step 2 of 4 — Optional</p>
        <h2 class="setup-title">Connect Google.</h2>
        <p class="setup-desc">
          Link a Google account to sync your settings across devices.
          Optional — your account works without it.
        </p>
        <button class="google-btn" id="btn-google">
          <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18z"/><path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17z"/><path fill="#FBBC05" d="M4.5 10.52a4.8 4.8 0 0 1 0-3.04V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07z"/><path fill="#EA4335" d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3z"/></svg>
          Continue with Google
        </button>
        <div class="setup-actions">
          <button class="btn-setup-skip" id="btn-step2-skip">Skip for now</button>
        </div>
      </div>

      <!-- Step 3: API Key (optional) -->
      <div class="setup-step" id="step-3">
        <div class="setup-progress">
          <div class="progress-dot done"></div>
          <div class="progress-dot done"></div>
          <div class="progress-dot active"></div>
          <div class="progress-dot"></div>
        </div>
        <p class="setup-eyebrow">Step 3 of 4 — Optional</p>
        <h2 class="setup-title">Add an AI key.</h2>
        <p class="setup-desc">
          Connect a free API key from Gemini, Groq, or another provider.
          Your key stays on this device — never sent to a server.
        </p>
        <div class="setup-field">
          <label for="input-provider">Provider</label>
          <select id="input-provider" style="width:100%;font-family:inherit;font-size:15px;color:var(--fg);background:white;border:1px solid var(--border);border-radius:4px;padding:0.6rem 0.85rem;outline:none;">
            <option value="gemini">Google Gemini (free tier available)</option>
            <option value="groq">Groq (free tier available)</option>
            <option value="openai">OpenAI</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="setup-field">
          <label for="input-apikey">API Key</label>
          <input type="password" id="input-apikey" placeholder="Paste your key here" autocomplete="off">
          <p class="field-hint">Stored in localStorage. Never leaves this browser.</p>
        </div>
        <div class="setup-actions">
          <button class="btn-primary" id="btn-step3-save">Save Key</button>
          <button class="btn-setup-skip" id="btn-step3-skip">Skip for now</button>
        </div>
      </div>

      <!-- Step 4: Ollama (optional) -->
      <div class="setup-step" id="step-4">
        <div class="setup-progress">
          <div class="progress-dot done"></div>
          <div class="progress-dot done"></div>
          <div class="progress-dot done"></div>
          <div class="progress-dot active"></div>
        </div>
        <p class="setup-eyebrow">Step 4 of 4 — Optional</p>
        <h2 class="setup-title">Connect Ollama.</h2>
        <p class="setup-desc">
          Running a local model? Connect Ollama for fully offline AI — no key required,
          no data ever leaves your machine.
        </p>
        <div class="setup-field">
          <label for="input-ollama">Ollama endpoint</label>
          <input type="text" id="input-ollama" value="http://localhost:11434" autocomplete="off">
          <p class="field-hint">Default: http://localhost:11434</p>
        </div>
        <div class="ollama-status" id="ollama-status"></div>
        <div class="setup-actions">
          <button class="btn-primary" id="btn-ollama-test">Test Connection</button>
          <button class="btn-setup-skip" id="btn-step4-skip">Skip for now</button>
        </div>
      </div>

      <!-- Done -->
      <div class="setup-step" id="step-done">
        <div class="setup-done-icon">✓</div>
        <h2 class="setup-title">You're set up.</h2>
        <p class="setup-desc">
          Your account is ready. Everything is stored locally on this device.
        </p>
        <div class="setup-actions">
          <a href="dashboard.html" class="btn-primary">Go to your dashboard</a>
          <a href="jane.html" class="btn-secondary">Talk to Jane</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ── Account state ──────────────────────────────────────
    const STORAGE_KEY = 'safe_account';

    function loadAccount() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null'); }
      catch { return null; }
    }

    function saveAccount(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function clearAccount() {
      localStorage.removeItem(STORAGE_KEY);
    }

    function applyAccountState() {
      const acct = loadAccount();
      const navChip   = document.getElementById('nav-user-chip');
      const navBtn    = document.getElementById('btn-nav-setup');
      const heroAnon  = document.getElementById('hero-actions-anon');
      const heroUser  = document.getElementById('hero-actions-user');
      const navName   = document.getElementById('nav-username');
      const heroName  = document.getElementById('hero-username');

      if (acct && acct.username) {
        navChip.style.display  = 'flex';
        navBtn.style.display   = 'none';
        heroAnon.style.display = 'none';
        heroUser.style.display = 'flex';
        navName.textContent  = acct.username;
        heroName.textContent = acct.username;
      } else {
        navChip.style.display  = 'none';
        navBtn.style.display   = '';
        heroAnon.style.display = '';
        heroUser.style.display = 'none';
      }
    }

    // ── Modal ──────────────────────────────────────────────
    const overlay = document.getElementById('setup-modal');
    let currentStep = 1;
    let pendingAccount = {};

    function openModal() {
      currentStep = 1;
      pendingAccount = {};
      showStep(1);
      overlay.classList.add('open');
      setTimeout(() => document.getElementById('input-username').focus(), 50);
    }

    function closeModal() {
      overlay.classList.remove('open');
    }

    function showStep(n) {
      document.querySelectorAll('.setup-step').forEach(s => s.classList.remove('active'));
      const el = document.getElementById(n === 'done' ? 'step-done' : `step-${n}`);
      if (el) el.classList.add('active');
    }

    document.getElementById('btn-nav-setup').addEventListener('click', openModal);
    document.getElementById('btn-hero-setup').addEventListener('click', openModal);
    document.getElementById('modal-close').addEventListener('click', closeModal);
    overlay.addEventListener('click', e => { if (e.target === overlay) closeModal(); });

    // Step 1: username
    document.getElementById('btn-step1-next').addEventListener('click', () => {
      const val = document.getElementById('input-username').value.trim();
      if (!val) { document.getElementById('input-username').focus(); return; }
      pendingAccount.username = val;
      pendingAccount.created_at = new Date().toISOString();
      showStep(2);
    });
    document.getElementById('input-username').addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('btn-step1-next').click();
    });

    // Step 2: Google (stub)
    document.getElementById('btn-google').addEventListener('click', () => {
      // OAuth wiring pending — mark as connected and continue
      pendingAccount.google = 'pending';
      showStep(3);
    });
    document.getElementById('btn-step2-skip').addEventListener('click', () => showStep(3));

    // Step 3: API key
    document.getElementById('btn-step3-save').addEventListener('click', () => {
      const provider = document.getElementById('input-provider').value;
      const key = document.getElementById('input-apikey').value.trim();
      if (key) {
        pendingAccount.api_provider = provider;
        pendingAccount.api_key = key;
      }
      showStep(4);
    });
    document.getElementById('btn-step3-skip').addEventListener('click', () => showStep(4));

    // Step 4: Ollama
    document.getElementById('btn-ollama-test').addEventListener('click', async () => {
      const endpoint = document.getElementById('input-ollama').value.trim();
      const statusEl = document.getElementById('ollama-status');
      statusEl.className = 'ollama-status';
      statusEl.textContent = 'Testing…';
      statusEl.style.display = 'block';
      try {
        const res = await fetch(`${endpoint}/api/tags`, { signal: AbortSignal.timeout(4000) });
        if (res.ok) {
          const data = await res.json();
          const models = (data.models || []).map(m => m.name).slice(0, 3).join(', ');
          pendingAccount.ollama = endpoint;
          statusEl.className = 'ollama-status ok';
          statusEl.textContent = `Connected. Models: ${models || 'none loaded'}`;
          setTimeout(finishSetup, 900);
        } else {
          throw new Error(`HTTP ${res.status}`);
        }
      } catch (e) {
        statusEl.className = 'ollama-status err';
        statusEl.textContent = `Could not connect — is Ollama running? (${e.message})`;
      }
    });
    document.getElementById('btn-step4-skip').addEventListener('click', finishSetup);

    function finishSetup() {
      saveAccount(pendingAccount);
      applyAccountState();
      showStep('done');
    }

    // Sign out
    document.getElementById('btn-signout').addEventListener('click', e => {
      e.preventDefault();
      clearAccount();
      applyAccountState();
    });

    applyAccountState();
  </script>

</body>
</html>
